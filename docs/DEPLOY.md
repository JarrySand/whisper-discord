# ğŸš€ ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¬ã‚¤ãƒ‰

ã“ã®ã‚¬ã‚¤ãƒ‰ã§ã¯ã€Discordæ–‡å­—èµ·ã“ã—Botã‚’ç„¡æ–™ã‚µãƒ¼ãƒãƒ¼ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹æ‰‹é †ã‚’èª¬æ˜ã—ã¾ã™ã€‚

---

## ğŸ“‹ å‰ææ¡ä»¶

- GitHub ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ
- Discord Bot Tokenï¼ˆ[Discord Developer Portal](https://discord.com/developers/applications)ã§å–å¾—ï¼‰
- Groq API Keyï¼ˆ[console.groq.com](https://console.groq.com)ã§å–å¾—ï¼‰

---

## ğŸ¯ æ¨å¥¨æ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Railway / Render / Fly.ioï¼ˆç„¡æ–™æ ï¼‰                     â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Discord Bot    â”‚ â”€â”€â–º â”‚  Whisper API Server     â”‚   â”‚
â”‚  â”‚  ~150MB RAM     â”‚     â”‚  ~50MB RAM (Groqãƒ¢ãƒ¼ãƒ‰) â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                      â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                                       â–¼
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚  Groq API (ã‚¯ãƒ©ã‚¦ãƒ‰) â”‚
                            â”‚  $0.0001/ç§’         â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš‚ Railway ã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆæ¨å¥¨ï¼‰

Railway ã¯ $5/æœˆã®ç„¡æ–™ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆãŒã‚ã‚Šã€ç°¡å˜ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã¾ã™ã€‚

### Step 1: GitHubã«ãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒ—ãƒƒã‚·ãƒ¥

```bash
# ãƒªãƒã‚¸ãƒˆãƒªåˆæœŸåŒ–ï¼ˆã¾ã ã®å ´åˆï¼‰
git init
git add .
git commit -m "Initial commit"

# GitHubã«ãƒ—ãƒƒã‚·ãƒ¥
git remote add origin https://github.com/YOUR_USERNAME/whisper-discord.git
git push -u origin main
```

### Step 2: Railway ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ

1. [railway.app](https://railway.app) ã«ã‚¢ã‚¯ã‚»ã‚¹
2. GitHub ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—

### Step 3: Whisper API ã‚µãƒ¼ãƒ“ã‚¹ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤

1. Railway Dashboard ã§ã€ŒNew Projectã€â†’ã€ŒDeploy from GitHub repoã€
2. ãƒªãƒã‚¸ãƒˆãƒªã‚’é¸æŠ
3. ã€ŒAdd Serviceã€â†’ã€ŒGitHub Repoã€â†’ åŒã˜ãƒªãƒã‚¸ãƒˆãƒªã‚’é¸æŠ
4. Settings ã§ä»¥ä¸‹ã‚’è¨­å®š:
   - **Root Directory**: `whisper-api`
   - **Builder**: Dockerfile

5. Variables ã‚¿ãƒ–ã§ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š:

```env
WHISPER_PROVIDER=groq
WHISPER_GROQ_API_KEY=gsk_xxxxxxxxxxxxx
WHISPER_GROQ_MODEL=whisper-large-v3
SERVER_HOST=0.0.0.0
SERVER_PORT=8000
LOG_LEVEL=INFO
```

6. ã€ŒDeployã€ã‚’ã‚¯ãƒªãƒƒã‚¯

### Step 4: Discord Bot ã‚µãƒ¼ãƒ“ã‚¹ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤

1. åŒã˜ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ã§ã€ŒAdd Serviceã€â†’ã€ŒGitHub Repoã€
2. Settings ã§ä»¥ä¸‹ã‚’è¨­å®š:
   - **Root Directory**: `bot`
   - **Builder**: Dockerfile

3. ã¾ãš Bot ã‚’ãƒ“ãƒ«ãƒ‰:
```bash
cd bot
npm install
npm run build
git add dist/
git commit -m "Add build files"
git push
```

4. Variables ã‚¿ãƒ–ã§ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š:

```env
DISCORD_BOT_TOKEN=your_discord_bot_token
DISCORD_CLIENT_ID=your_discord_client_id
WHISPER_API_URL=http://whisper-api.railway.internal:8000
WHISPER_API_TIMEOUT=60000
AUDIO_SILENCE_THRESHOLD=800
AUDIO_MAX_SEGMENT_DURATION=8000
AUDIO_MIN_SEGMENT_DURATION=1000
AUDIO_MIN_RMS_THRESHOLD=0.005
OUTPUT_ENABLE_DISCORD_POST=true
OUTPUT_ENABLE_FILE_LOG=true
LOG_LEVEL=info
```

> **Note**: `WHISPER_API_URL` ã¯ Railway ã®å†…éƒ¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚
> ã‚µãƒ¼ãƒ“ã‚¹åãŒ `whisper-api` ã®å ´åˆã€`http://whisper-api.railway.internal:8000` ã«ãªã‚Šã¾ã™ã€‚

5. ã€ŒDeployã€ã‚’ã‚¯ãƒªãƒƒã‚¯

### Step 5: æ¥ç¶šç¢ºèª

1. Railway ã® Logs ã‚¿ãƒ–ã§ãƒ­ã‚°ã‚’ç¢ºèª
2. Discord ã§ `/join` ã‚³ãƒãƒ³ãƒ‰ã‚’ãƒ†ã‚¹ãƒˆ

---

## ğŸ¨ Render ã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤

Render ã¯ 750æ™‚é–“/æœˆã®ç„¡æ–™æ ãŒã‚ã‚Šã¾ã™ã€‚

### Step 1: render.yaml ã‚’ä½œæˆ

```yaml
# render.yaml
services:
  - type: web
    name: whisper-api
    runtime: docker
    dockerfilePath: ./whisper-api/Dockerfile
    dockerContext: ./whisper-api
    envVars:
      - key: WHISPER_PROVIDER
        value: groq
      - key: WHISPER_GROQ_API_KEY
        sync: false
      - key: WHISPER_GROQ_MODEL
        value: whisper-large-v3

  - type: worker
    name: discord-bot
    runtime: docker
    dockerfilePath: ./bot/Dockerfile
    dockerContext: ./bot
    envVars:
      - key: DISCORD_BOT_TOKEN
        sync: false
      - key: DISCORD_CLIENT_ID
        sync: false
      - key: WHISPER_API_URL
        fromService:
          name: whisper-api
          type: web
          property: host
```

### Step 2: Render ã«ãƒ‡ãƒ—ãƒ­ã‚¤

1. [render.com](https://render.com) ã§ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ
2. ã€ŒNewã€â†’ã€ŒBlueprintã€â†’ ãƒªãƒã‚¸ãƒˆãƒªã‚’é¸æŠ
3. ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã—ã¦ Deploy

---

## ğŸª Fly.io ã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤

Fly.io ã¯ 3 VM ã¾ã§ç„¡æ–™ã§ã™ã€‚

### Step 1: Fly CLI ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
# Windows (PowerShell)
powershell -Command "iwr https://fly.io/install.ps1 -useb | iex"

# Mac/Linux
curl -L https://fly.io/install.sh | sh
```

### Step 2: ãƒ­ã‚°ã‚¤ãƒ³

```bash
fly auth login
```

### Step 3: Whisper API ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
cd whisper-api

# ã‚¢ãƒ—ãƒªä½œæˆ
fly launch --name whisper-api-yourname --no-deploy

# ç’°å¢ƒå¤‰æ•°è¨­å®š
fly secrets set WHISPER_PROVIDER=groq
fly secrets set WHISPER_GROQ_API_KEY=gsk_xxxxx

# ãƒ‡ãƒ—ãƒ­ã‚¤
fly deploy
```

### Step 4: Discord Bot ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
cd ../bot

# ãƒ“ãƒ«ãƒ‰
npm install
npm run build

# ã‚¢ãƒ—ãƒªä½œæˆ
fly launch --name discord-bot-yourname --no-deploy

# ç’°å¢ƒå¤‰æ•°è¨­å®š
fly secrets set DISCORD_BOT_TOKEN=xxx
fly secrets set DISCORD_CLIENT_ID=xxx
fly secrets set WHISPER_API_URL=https://whisper-api-yourname.fly.dev

# ãƒ‡ãƒ—ãƒ­ã‚¤
fly deploy
```

---

## ğŸ”§ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### Bot ãŒèµ·å‹•ã—ãªã„

1. ãƒ­ã‚°ã‚’ç¢ºèª:
```bash
# Railway
railway logs

# Fly.io
fly logs
```

2. ç’°å¢ƒå¤‰æ•°ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

### Whisper API ã«æ¥ç¶šã§ããªã„

1. å†…éƒ¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ URL ãŒæ­£ã—ã„ã‹ç¢ºèª
2. ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ (`/health`) ã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã‹ç¢ºèª

### ãƒ¡ãƒ¢ãƒªä¸è¶³

Groq ãƒ¢ãƒ¼ãƒ‰ãªã‚‰ 256MB ã§ååˆ†ã§ã™ãŒã€ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹å ´åˆ:
- Railway: ã€ŒSettingsã€â†’ã€ŒResource Limitsã€ã§ãƒ¡ãƒ¢ãƒªã‚’å¢—ã‚„ã™
- Fly.io: `fly scale memory 512`

---

## ğŸ’° ã‚³ã‚¹ãƒˆè©¦ç®—

| é …ç›® | ã‚³ã‚¹ãƒˆ |
|------|--------|
| Railwayï¼ˆ$5ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆå†…ï¼‰ | **$0** |
| Groq APIï¼ˆ100æ™‚é–“/æœˆï¼‰ | **$36** |
| **åˆè¨ˆ** | **$36/æœˆ** |

---

## ğŸ“ ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] Bot ãŒ Discord ã«æ¥ç¶šã—ã¦ã„ã‚‹
- [ ] `/join` ã‚³ãƒãƒ³ãƒ‰ãŒå‹•ä½œã™ã‚‹
- [ ] éŸ³å£°ãŒæ–‡å­—èµ·ã“ã—ã•ã‚Œã‚‹
- [ ] ãƒ­ã‚°ãŒæ­£å¸¸ã«å‡ºåŠ›ã•ã‚Œã¦ã„ã‚‹

---

## ğŸ”— é–¢é€£ãƒªãƒ³ã‚¯

- [Railway Documentation](https://docs.railway.app)
- [Render Documentation](https://render.com/docs)
- [Fly.io Documentation](https://fly.io/docs)
- [Groq API Console](https://console.groq.com)

